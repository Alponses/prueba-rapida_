{% extends "base.html" %}
{% block title %}Productos — GabosTours{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header">
    <div class="d-flex justify-content-between align-items-center">
      <h3 class="card-title">Productos</h3>
      {% url 'productos:producto_create' as producto_create_url %}
      {% include "includes/card_header.html" with title="Productos" add_url=producto_create_url can_add=perms.core.add_producto %}
    </div>
  </div>

  <div class="card-body">
    <form method="get" class="mb-4">
      <div class="input-group">
        <input type="text" name="q" class="form-control"
               placeholder="Buscar por nombre, tipo, proveedor o destino..."
               value="{{ request.GET.q }}">
        <button type="submit" class="btn btn-outline-secondary">
          <i class="fas fa-search"></i> Buscar
        </button>
      </div>
    </form>

    <div class="table-responsive">
      <table class="table table-striped table-hover align-middle" data-datatable data-empty="Sin productos registrados.">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Proveedor</th>
            <th>Destino</th>
            <th>Precio base</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos %}
          <tr>
            <td>{{ p.nombre }}</td>
            <td>{{ p.tipo }}</td>
            <td>{{ p.proveedor.nombre }}</td>
            <td>{{ p.destino }}</td>
            <td>${{ p.precio_base }}</td>
            <td class="text-nowrap">
              {% if perms.core.change_producto %}
              <a href="{% url 'productos:producto_update' p.pk %}" class="btn btn-sm btn-info" title="Editar">
                <i class="fas fa-edit"></i>
              </a>
              {% endif %}
              {% if perms.core.delete_producto %}
              <a href="{% url 'productos:producto_delete' p.pk %}" class="btn btn-sm btn-danger" title="Eliminar">
                <i class="fas fa-trash"></i>
              </a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if is_paginated %}
    <nav aria-label="Paginación">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
            Anterior
          </a>
        </li>
        {% endif %}

        <li class="page-item active">
          <span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        </li>

        {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
            Siguiente
          </a>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  </div>
</div>
{% endblock %}
